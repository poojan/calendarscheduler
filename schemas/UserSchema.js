'use strict';

/*
 *  File: UserSchema.js
 *  Type: Schema
 *  Generated by: Mongoose-Fixture (v0.4.1)
 *
 *
 */

module.exports = function(mongoose, conn){
  var UserSchema = new mongoose.Schema({
    'username': { type: String, required: true, unique: true },
    'password': { type: String, required: true },
    'totalLessonTime': { type: Number },
    'totalOvercomeWeakness': { type: Number },
    'team': [{
      '_teacherId': mongoose.Schema.Types.ObjectId
    }]
  });

  UserSchema.statics.getTeam0 = function (teacherFilter, callback) {
    var promise = new mongoose.Promise();
    if (callback) { promise.addBack(callback); }

    var fields = '_id name sex dob info image availability';
    //this.find($or: teacherFilter, fields, promise.resolve.bind(promise));
    teacherFilter = teacherFilter.length ? { $or: teacherFilter } : { 1: 2 };
    mongoose.model('Teacher').find(teacherFilter, fields, promise.resolve.bind(promise));
    //this.find({}, fields, promise.resolve.bind(promise));
    return promise;
  };

  UserSchema.statics.getTeam = function (userId, callback) {

    var promise = new mongoose.Promise();
    if (callback) { promise.addBack(callback); }
    this.findById(userId, function (err, user) {
      var teacherFilter = user.team;

      var fields = '_id name sex dob info image availability';
      teacherFilter = teacherFilter.length ? { $or: teacherFilter } : { 1: 2 };
      mongoose.model('Teacher').find(teacherFilter, fields, promise.resolve.bind(promise));
    });
    return promise;
  };


  // mongoose-fixture schemas return this consumable format
  // which allows for you to easily register your models
  // into mongoose/conn
  return { name:'Users', schema: UserSchema };
};
